include layout_header
div(class='gallery-heading')
  h1 !{web_title}
  br
  h2 The Gallery
div(class='page')
  - photosCount = 0
  - photosTotal = photoFiles.length
  - photosPerPage = 20
  - photosStart = paramStart
  - photosTotalPages = Math.ceil(photosTotal / photosPerPage)
  - photosCurrentPage = Math.floor(photosStart / photosPerPage) + 1
  - photosEnd = photosStart + photosPerPage
  - photosNextPage = ((photosStart + photosPerPage) < photosTotal ? (photosStart + photosPerPage) : photosStart)
  - photosPrevPage = ((photosStart - photosPerPage) < 0 ? 0 : (photosStart - photosPerPage))
  while photosCount < photosPerPage
    - if (typeof(photoFiles[photosStart + photosCount]) !== 'undefined'){
      img(id=photosCount src=('images/' + prefix_thumbnails + photoFiles[photosStart + photosCount]) alt=photoFiles[photosStart + photosCount] class='gallery-thumbnails' onclick='openModal(this);')
    -}
    - photosCount++        
div(id='gallery-modal' class='modal')
  |<svg id="modal-close-button" viewBox="0 0 300 300" version="1.1" xmlns="http://www.w3.org/2000/svg" onclick="closeModal();">
  | <title>Close</title>
  | <g>
  |   <path fill="#ffffff" opacity="1.00" d=" M 146.54 0.00 L 153.47 0.00 C 184.96 0.65 216.20 11.50 241.09 30.85 C 267.14 50.66 286.43 79.21 294.89 110.84 C 298.01 122.48 299.68 134.48 300.00 146.52 L 300.00 153.49 C 299.34 185.00 288.48 216.26 269.10 241.16 C 247.71 269.25 216.12 289.49 181.51 296.70 C 172.31 298.75 162.89 299.69 153.48 300.00 L 146.62 300.00 C 115.33 299.34 84.28 288.63 59.48 269.49 C 32.02 248.77 11.98 218.33 4.15 184.80 C 1.49 173.90 0.36 162.70 0.00 151.51 L 0.00 150.45 C 0.27 139.61 1.08 128.74 3.50 118.14 C 10.81 83.43 31.26 51.77 59.56 30.45 C 84.33 11.36 115.31 0.68 146.54 0.00 M 90.74 63.49 C 81.96 72.20 73.22 80.95 64.51 89.72 C 61.36 92.47 61.27 97.71 64.38 100.52 C 80.00 116.24 95.70 131.88 111.37 147.54 C 95.66 163.45 79.57 178.97 63.96 194.97 C 60.65 198.32 62.09 203.76 65.57 206.39 C 74.15 214.87 82.57 223.52 91.21 231.92 C 94.00 234.80 98.97 234.45 101.56 231.47 C 117.23 215.87 132.85 200.20 148.49 184.57 C 164.23 200.17 179.70 216.06 195.49 231.63 C 198.14 234.56 203.10 234.70 205.82 231.79 C 214.73 223.04 223.52 214.15 232.35 205.31 C 235.52 202.56 235.62 197.28 232.48 194.46 C 216.87 178.75 201.17 163.12 185.50 147.45 C 201.08 131.73 216.95 116.28 232.50 100.52 C 234.77 98.38 235.50 94.82 234.09 92.00 C 232.97 90.13 231.35 88.66 229.83 87.13 C 221.79 79.18 213.89 71.08 205.79 63.19 C 203.07 60.30 198.13 60.45 195.49 63.37 C 179.75 79.01 164.09 94.74 148.40 110.43 C 132.52 94.75 117.01 78.71 101.07 63.10 C 98.29 60.22 93.34 60.53 90.74 63.49 Z" />
  | </g>
  |</svg>
  |<svg id="modal-next-button" viewBox="0 0 300 300" version="1.1" xmlns="http://www.w3.org/2000/svg"  onclick="swipeModal(1);" alt="Next">
  | <title>Next</title>
  | <g>
  |   <path fill="#ffffff" opacity="1.00" d=" M 140.59 0.00 L 159.38 0.00 C 166.21 0.97 173.12 1.46 179.87 3.00 C 211.84 9.30 241.36 26.72 262.77 51.23 C 282.54 73.69 295.33 102.19 298.86 131.90 C 299.48 138.02 299.58 144.18 300.00 150.32 L 300.00 151.68 C 299.37 160.85 299.15 170.11 297.09 179.11 C 290.98 210.63 274.23 239.89 250.38 261.35 C 228.18 281.51 199.80 294.80 170.04 298.67 C 166.49 299.10 162.94 299.49 159.40 300.00 L 140.60 300.00 C 129.27 298.77 117.95 297.09 106.99 293.85 C 78.33 285.17 52.29 267.83 33.51 244.47 C 18.10 225.61 7.31 202.89 2.81 178.93 C 1.36 172.50 0.94 165.91 0.00 159.40 L 0.00 140.61 C 0.91 134.37 1.40 128.06 2.66 121.88 C 6.88 98.55 17.12 76.36 31.75 57.75 C 50.67 33.28 77.42 15.09 107.00 6.15 C 117.96 2.96 129.27 1.30 140.59 0.00 M 109.45 67.53 C 106.28 68.43 104.05 71.63 104.29 74.93 C 104.24 123.30 104.33 171.68 104.25 220.06 C 104.23 222.39 104.41 225.06 106.43 226.60 C 108.96 229.32 113.30 229.26 116.17 227.13 C 152.43 202.71 188.74 178.35 224.98 153.90 C 228.69 151.71 229.71 146.32 227.01 142.96 C 224.92 140.65 222.10 139.20 219.56 137.46 C 186.08 115.29 152.62 93.07 119.19 70.83 C 116.34 68.92 113.12 66.37 109.45 67.53 Z" />
  | </g>
  |</svg>
  |<svg id="modal-previous-button" viewBox="0 0 300 300" version="1.1" xmlns="http://www.w3.org/2000/svg"  onclick="swipeModal(-1);" alt="Previous">
  | <title>Previous</title>
  | <g>
  |   <path fill="#ffffff" opacity="1.00" d=" M 146.49 0.00 L 153.51 0.00 C 184.99 0.66 216.21 11.51 241.09 30.84 C 269.42 52.39 289.77 84.30 296.86 119.22 C 298.81 128.17 299.68 137.32 300.00 146.46 L 300.00 153.54 C 299.33 185.01 288.48 216.23 269.15 241.10 C 248.03 268.86 216.95 288.97 182.83 296.42 C 173.21 298.64 163.35 299.69 153.48 300.00 L 146.50 300.00 C 115.25 299.31 84.25 288.61 59.48 269.49 C 31.22 248.17 10.82 216.55 3.50 181.88 C 1.23 171.94 0.38 161.74 0.00 151.57 L 0.00 150.41 C 0.27 139.35 1.13 128.26 3.65 117.46 C 11.08 83.01 31.45 51.63 59.56 30.44 C 84.31 11.37 115.28 0.69 146.49 0.00 M 186.43 67.58 C 185.52 67.90 184.67 68.32 183.87 68.85 C 147.77 92.78 111.69 116.75 75.60 140.68 C 72.45 142.43 70.48 146.39 71.77 149.87 C 72.52 152.36 74.84 153.80 76.86 155.18 C 111.56 178.50 146.24 201.84 180.92 225.18 C 183.33 226.80 185.86 228.90 188.97 228.66 C 192.76 228.52 196.06 224.99 195.74 221.16 C 195.74 172.44 195.78 123.71 195.72 74.99 C 196.19 70.08 191.10 66.05 186.43 67.58 Z" />
  | </g>
  |</svg>
  img(id='modal-photo' class='modal-content')
div(class="pagination")
  p.
    #[a(href='gallery?s=0') <<] #[a(href='gallery?s=' + photosPrevPage) <] !{photosCurrentPage} of !{photosTotalPages} #[a(href='gallery?s=' + photosNextPage) >] #[a(href='gallery?s=' + ((photosTotalPages-1) * photosPerPage)) >>]
script.
  currentPhotoID = 0;
  function openModal(photo) {
    document.body.style.overflow = 'hidden';
    document.getElementById('gallery-modal').style.display = 'block';
    document.getElementById('modal-photo').src = 'images/!{prefix_previews}' + photo.alt;
    currentPhotoID = Number(photo.id);
  }
  function closeModal() {
    document.getElementById('gallery-modal').style.display = 'none';
    document.body.style.overflow = 'auto';
  }
  function swipeModal(direction) {
    if( (currentPhotoID + direction) >= 0 && (currentPhotoID + direction) < !{photosPerPage}) {
      openModal(document.getElementById((currentPhotoID + direction)))
    }
  }

  // Swiping controls on Modal
  document.getElementById('gallery-modal').addEventListener('touchstart', function (event) {
    touchStartX = event.changedTouches[0].screenX;
  }, false);
  document.getElementById('gallery-modal').addEventListener('touchend', function (event) {
    touchEndX = event.changedTouches[0].screenX;
    swipeGesture();
  }, false);
  function swipeGesture() {
      if (touchEndX < (touchStartX - 75)) swipeModal(1);
      if (touchEndX > (touchStartX + 75)) swipeModal(-1);      
  }
include layout_signature
include layout_footer